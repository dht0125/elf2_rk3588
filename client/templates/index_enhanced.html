<script src="https://cdn.bootcss.com/flv.js/1.5.0/flv.js"></script>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½äº¤é€šç›‘æ§ä¸IoTæ§åˆ¶ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* è§†é¢‘æµéƒ¨åˆ† */
        .video-section {
            grid-column: 1 / -1;
            margin-bottom: 20px;
        }

        .video-container {
            position: relative;
            text-align: center;
            margin-bottom: 20px;
        }

        .video-stream {
            max-width: 100%;
            height: auto;
            border: 3px solid #667eea;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .video-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        /* IoTè®¾å¤‡æ§åˆ¶ */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .device-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .device-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .device-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .device-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .device-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 10px 0;
            color: #667eea;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-online {
            background-color: #28a745;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .status-offline {
            background-color: #dc3545;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .device-grid {
                grid-template-columns: 1fr;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* è¿æ¥çŠ¶æ€ */
        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .connection-text {
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— æ™ºèƒ½äº¤é€šç›‘æ§ä¸IoTæ§åˆ¶ç³»ç»Ÿ</h1>
            <p>å®æ—¶è½¦è¾†æ£€æµ‹ã€è§†é¢‘æµä¼ è¾“ä¸è®¾å¤‡æ§åˆ¶ä¸€ä½“åŒ–å¹³å°</p>
            <div class="connection-status">
                <span class="status-indicator" id="main-status-indicator"></span>
                <span class="connection-text" id="main-status-text">ç³»ç»ŸçŠ¶æ€æ£€æµ‹ä¸­...</span>
            </div>
        </div>

        <div class="main-content">
            <!-- è§†é¢‘æµéƒ¨åˆ† -->
            <div class="section video-section">
                <h2>ğŸ¥ å®æ—¶è§†é¢‘ç›‘æ§</h2>
                <div class="video-container">
                    <img src="/video_stream" class="video-stream" alt="å®æ—¶è§†é¢‘æµ" id="video-stream">
                    <div class="video-overlay" id="video-overlay">
                        <div>ğŸš— å½“å‰è½¦è¾†: <span id="overlay-car-count">0</span></div>
                        <div>ğŸ“Š æ£€æµ‹FPS: <span id="overlay-fps">0.0</span></div>
                        <div>âš¡ å¤„ç†æ—¶é—´: <span id="overlay-process-time">0.0</span>ms</div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="current-cars">0</div>
                        <div class="stat-label">å½“å‰è½¦è¾†æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-detections">0</div>
                        <div class="stat-label">æ€»æ£€æµ‹æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="traffic-density">0.0</div>
                        <div class="stat-label">äº¤é€šå¯†åº¦</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="processing-fps">0.0</div>
                        <div class="stat-label">å¤„ç†FPS</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ai-process-time">0.0</div>
                        <div class="stat-label">AIå¤„ç†æ—¶é—´(ms)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="system-status">ç¦»çº¿</div>
                        <div class="stat-label">ç³»ç»ŸçŠ¶æ€</div>
                    </div>
                </div>
            </div>

            <!-- IoTè®¾å¤‡æ§åˆ¶éƒ¨åˆ† -->
            <div class="section">
                <h2>ğŸ  IoTè®¾å¤‡æ§åˆ¶</h2>
                <div class="device-grid">
                    <div class="device-card">
                        <div class="device-header">
                            <div class="device-icon">ğŸŒ¡ï¸</div>
                            <div class="device-name">æ¸©åº¦ä¼ æ„Ÿå™¨</div>
                        </div>
                        <div class="device-value"><span id="temperature">--</span>Â°C</div>
                        <div class="stat-label">ç¯å¢ƒæ¸©åº¦</div>
                    </div>

                    <div class="device-card">
                        <div class="device-header">
                            <div class="device-icon">ğŸ’§</div>
                            <div class="device-name">æ¹¿åº¦ä¼ æ„Ÿå™¨</div>
                        </div>
                        <div class="device-value"><span id="humidity">--</span>%</div>
                        <div class="stat-label">ç¯å¢ƒæ¹¿åº¦</div>
                    </div>

                    <div class="device-card">
                        <div class="device-header">
                            <div class="device-icon">âš¡</div>
                            <div class="device-name">ç”µå‹ç›‘æµ‹</div>
                        </div>
                        <div class="device-value"><span id="voltage">--</span>V</div>
                        <div class="stat-label">ä¾›ç”µç”µå‹</div>
                    </div>

                    <div class="device-card">
                        <div class="device-header">
                            <div class="device-icon">ğŸ’¡</div>
                            <div class="device-name">LEDæ§åˆ¶</div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">
                                LED 1 
                                <span class="status-indicator" id="led1-status"></span>
                            </label>
                            <div class="switch-container">
                                <label class="switch">
                                    <input type="checkbox" id="led1-switch">
                                    <span class="slider"></span>
                                </label>
                                <span id="led1-text">å…³é—­</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">
                                LED 2 
                                <span class="status-indicator" id="led2-status"></span>
                            </label>
                            <div class="switch-container">
                                <label class="switch">
                                    <input type="checkbox" id="led2-switch">
                                    <span class="slider"></span>
                                </label>
                                <span id="led2-text">å…³é—­</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿæ§åˆ¶éƒ¨åˆ† -->
            <div class="section">
                <h2>âš™ï¸ ç³»ç»Ÿæ§åˆ¶</h2>
                <div style="text-align: center;">
                    <button class="btn" onclick="refreshAllData()">ğŸ”„ åˆ·æ–°æ‰€æœ‰æ•°æ®</button>
                    <button class="btn btn-success" onclick="resetVideoStats()">ğŸ“Š é‡ç½®è§†é¢‘ç»Ÿè®¡</button>
                    <button class="btn btn-danger" onclick="emergencyStop()">ğŸš¨ ç´§æ€¥åœæ­¢</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>ğŸ“ˆ ç³»ç»Ÿç›‘æ§</h3>
                    <div id="system-log" style="background: #f1f1f1; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.9em;">
                        <div>ç³»ç»Ÿæ—¥å¿—åˆå§‹åŒ–...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let isSystemOnline = false;
        let videoDataUpdateInterval;
        let iotDataUpdateInterval;
        let logContainer;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('system-log');
            addLog('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            
            // è®¾ç½®LEDå¼€å…³äº‹ä»¶
            setupLEDControls();
            
            // å¼€å§‹æ•°æ®æ›´æ–°
            startDataUpdates();
            
            addLog('å¼€å§‹æ•°æ®æ›´æ–°å¾ªç¯');
        });

        function addLog(message) {
            const now = new Date();
            const timestamp = now.toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // ä¿æŒæœ€å¤š100æ¡æ—¥å¿—
            if (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        function setupLEDControls() {
            const led1Switch = document.getElementById('led1-switch');
            const led2Switch = document.getElementById('led2-switch');
            
            led1Switch.addEventListener('change', function() {
                controlLED('LEDSwitch', this.checked ? 1 : 0, 'LED1');
            });
            
            led2Switch.addEventListener('change', function() {
                controlLED('LEDSwitch2', this.checked ? 1 : 0, 'LED2');
            });
        }

        function controlLED(name, state, ledName) {
            const formData = new FormData();
            formData.append('name', name);
            formData.append('state', state);
            
            fetch('/set_data', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                if (data === 'True') {
                    addLog(`âœ… ${ledName} ${state ? 'å¼€å¯' : 'å…³é—­'}æˆåŠŸ`);
                    updateLEDStatus(ledName.toLowerCase(), state);
                } else {
                    addLog(`âŒ ${ledName} æ§åˆ¶å¤±è´¥`);
                }
            })
            .catch(error => {
                addLog(`âŒ ${ledName} æ§åˆ¶é”™è¯¯: ${error}`);
            });
        }

        function updateLEDStatus(ledId, state) {
            const statusIndicator = document.getElementById(`${ledId}-status`);
            const statusText = document.getElementById(`${ledId}-text`);
            
            if (state) {
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = 'å¼€å¯';
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'å…³é—­';
            }
        }

        function startDataUpdates() {
            // æ›´æ–°è§†é¢‘æ•°æ®
            videoDataUpdateInterval = setInterval(updateVideoData, 1000);
            
            // æ›´æ–°IoTè®¾å¤‡æ•°æ®
            iotDataUpdateInterval = setInterval(updateIoTData, 2000);
            
            // ç«‹å³æ›´æ–°ä¸€æ¬¡
            updateVideoData();
            updateIoTData();
        }

        function updateVideoData() {
            fetch('/get_detection_data')
                .then(response => response.json())
                .then(data => {
                    // æ›´æ–°è§†é¢‘ç»Ÿè®¡æ•°æ®
                    document.getElementById('current-cars').textContent = data.car_count || 0;
                    document.getElementById('total-detections').textContent = data.total_detections || 0;
                    document.getElementById('traffic-density').textContent = (data.traffic_density || 0).toFixed(2);
                    document.getElementById('processing-fps').textContent = (data.frame_fps || 0).toFixed(1);
                    document.getElementById('ai-process-time').textContent = (data.ai_process_time || 0).toFixed(1);
                    
                    // æ›´æ–°è§†é¢‘å åŠ å±‚
                    document.getElementById('overlay-car-count').textContent = data.car_count || 0;
                    document.getElementById('overlay-fps').textContent = (data.frame_fps || 0).toFixed(1);
                    document.getElementById('overlay-process-time').textContent = (data.ai_process_time || 0).toFixed(1);
                    
                    // æ›´æ–°ç³»ç»ŸçŠ¶æ€
                    const currentTime = Date.now();
                    const dataTime = (data.timestamp || 0) * 1000;
                    const isOnline = currentTime - dataTime < 10000; // 10ç§’å†…ä¸ºåœ¨çº¿
                    
                    const statusElement = document.getElementById('system-status');
                    const mainStatusIndicator = document.getElementById('main-status-indicator');
                    const mainStatusText = document.getElementById('main-status-text');
                    
                    if (isOnline) {
                        statusElement.textContent = 'åœ¨çº¿';
                        statusElement.style.color = '#28a745';
                        mainStatusIndicator.className = 'status-indicator status-online';
                        mainStatusText.textContent = 'è§†é¢‘æ£€æµ‹ç³»ç»Ÿåœ¨çº¿';
                        
                        if (!isSystemOnline) {
                            addLog('ğŸŸ¢ è§†é¢‘æ£€æµ‹ç³»ç»Ÿå·²è¿æ¥');
                            isSystemOnline = true;
                        }
                    } else {
                        statusElement.textContent = 'ç¦»çº¿';
                        statusElement.style.color = '#dc3545';
                        mainStatusIndicator.className = 'status-indicator status-offline';
                        mainStatusText.textContent = 'è§†é¢‘æ£€æµ‹ç³»ç»Ÿç¦»çº¿';
                        
                        if (isSystemOnline) {
                            addLog('ğŸ”´ è§†é¢‘æ£€æµ‹ç³»ç»Ÿè¿æ¥æ–­å¼€');
                            isSystemOnline = false;
                        }
                    }
                })
                .catch(error => {
                    if (isSystemOnline) {
                        addLog('âŒ è§†é¢‘æ•°æ®è·å–å¤±è´¥: ' + error);
                    }
                    
                    document.getElementById('system-status').textContent = 'é”™è¯¯';
                    document.getElementById('system-status').style.color = '#dc3545';
                    document.getElementById('main-status-indicator').className = 'status-indicator status-offline';
                    document.getElementById('main-status-text').textContent = 'è¿æ¥é”™è¯¯';
                    isSystemOnline = false;
                });
        }

        function updateIoTData() {
            fetch('/get_data')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    // æ£€æŸ¥å“åº”å†…å®¹ç±»å‹
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        console.warn('âš ï¸ å“åº”ä¸æ˜¯JSONæ ¼å¼:', contentType);
                        return response.text().then(text => {
                            console.log('ğŸ“„ å“åº”å†…å®¹:', text.substring(0, 200) + '...');
                            throw new Error('æœåŠ¡å™¨è¿”å›éJSONæ•°æ®ï¼Œå¯èƒ½æ˜¯HTMLé”™è¯¯é¡µé¢');
                        });
                    }
                    
                    return response.json();
                })
                .then(data => {
                    // æ£€æŸ¥æ•°æ®æ˜¯å¦æœ‰æ•ˆ
                    if (!data || typeof data !== 'object') {
                        throw new Error('æ— æ•ˆçš„JSONæ•°æ®');
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                    if (data.status === 'error' || data.status === 'offline') {
                        addLog('âŒ IoTæ•°æ®è·å–å¤±è´¥: ' + (data.error || 'è®¾å¤‡ç¦»çº¿'));
                        // æ˜¾ç¤ºé»˜è®¤å€¼
                        document.getElementById('temperature').textContent = '--';
                        document.getElementById('humidity').textContent = '--';
                        document.getElementById('voltage').textContent = '--';
                        return;
                    }
                    
                    // æ›´æ–°ä¼ æ„Ÿå™¨æ•°æ®
                    document.getElementById('temperature').textContent = 
                        (data.temp !== undefined && data.temp !== null) ? data.temp : '--';
                    document.getElementById('humidity').textContent = 
                        (data.humi !== undefined && data.humi !== null) ? data.humi : '--';
                    document.getElementById('voltage').textContent = 
                        (data.volt !== undefined && data.volt !== null) ? data.volt : '--';
                    
                    // æ›´æ–°LEDçŠ¶æ€
                    const led1State = data.led1 || 0;
                    const led2State = data.led2 || 0;
                    
                    document.getElementById('led1-switch').checked = led1State === 1;
                    document.getElementById('led2-switch').checked = led2State === 1;
                    
                    updateLEDStatus('led1', led1State);
                    updateLEDStatus('led2', led2State);
                    
                    // å¦‚æœä¹‹å‰æœ‰é”™è¯¯ï¼Œç°åœ¨æˆåŠŸäº†ï¼Œè®°å½•ä¸€ä¸‹
                    if (data.status === 'online') {
                        console.log('âœ… IoTæ•°æ®æ›´æ–°æˆåŠŸ');
                    }
                })
                .catch(error => {
                    // è¯¦ç»†çš„é”™è¯¯è®°å½•
                    console.error('âŒ IoTæ•°æ®è·å–é”™è¯¯:', error);
                    addLog('âŒ IoTæ•°æ®è·å–å¤±è´¥: ' + error.message);
                    
                    // æ˜¾ç¤ºé»˜è®¤å€¼
                    document.getElementById('temperature').textContent = '--';
                    document.getElementById('humidity').textContent = '--';
                    document.getElementById('voltage').textContent = '--';
                });
        }

        function refreshAllData() {
            addLog('ğŸ”„ åˆ·æ–°æ‰€æœ‰æ•°æ®');
            updateVideoData();
            updateIoTData();
        }

        function resetVideoStats() {
            if (confirm('ç¡®å®šè¦é‡ç½®è§†é¢‘ç»Ÿè®¡æ•°æ®å—ï¼Ÿ')) {
                fetch('/reset_stats', {method: 'POST'})
                    .then(response => response.json())
                    .then(data => {
                        addLog('ğŸ“Š è§†é¢‘ç»Ÿè®¡æ•°æ®å·²é‡ç½®');
                        updateVideoData();
                    })
                    .catch(error => {
                        addLog('âŒ é‡ç½®å¤±è´¥: ' + error);
                    });
            }
        }

        function emergencyStop() {
            if (confirm('ç¡®å®šè¦æ‰§è¡Œç´§æ€¥åœæ­¢å—ï¼Ÿè¿™å°†å…³é—­æ‰€æœ‰LEDå¹¶åœæ­¢ç³»ç»Ÿç›‘æ§ã€‚')) {
                // å…³é—­æ‰€æœ‰LED
                controlLED('LEDSwitch', 0, 'LED1');
                controlLED('LEDSwitch2', 0, 'LED2');
                
                // åœæ­¢æ•°æ®æ›´æ–°
                clearInterval(videoDataUpdateInterval);
                clearInterval(iotDataUpdateInterval);
                
                addLog('ğŸš¨ ç´§æ€¥åœæ­¢æ‰§è¡Œå®Œæˆ');
                
                // 5ç§’åé‡æ–°å¯åŠ¨ç›‘æ§
                setTimeout(() => {
                    addLog('ğŸ”„ é‡æ–°å¯åŠ¨ç³»ç»Ÿç›‘æ§');
                    startDataUpdates();
                }, 5000);
            }
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', function() {
            if (videoDataUpdateInterval) clearInterval(videoDataUpdateInterval);
            if (iotDataUpdateInterval) clearInterval(iotDataUpdateInterval);
        });
    </script>
</body>
</html> 